% !TEX root = ../../root.tex
\subsection{Setup}\label{subsec:sw_setup}
An overview of the host system used for the development is hereby provided for reference purposes.

\subsubsection{Development environment}
The choice of an integrated development environment has fallen on \emph{Ac6 System Workbench for STM32}, an Eclipse-based IDE tailored around STMicroelectronics line of microcontrollers.
The distribution is based on open-source software, and requires little to no configuration.
The components shipped with it are:
\begin{description}
    \item[GCC ARM Embedded] GCC-based cross compiler and debugger for ARM Cortex platform
    \item[OpenOCD] On-chip debugging tool supporting a wide range or generic JTAG/SWD interfaces
    \item[Eclipse CDT] An extensible multi-language IDE
\end{description}
All of these packages could be installed manually by fetching them from their respective sources, but doing so with a single archive is undoubtedly more convenient.
On top of this, it also comes with its own project management facilities like build setting manager, linker script editor, STM evaluation boards library, and so forth.

These latter tools are not taken advantage of --- the project is in fact built using \texttt{make}, as it is the supported build system for both ChibiOS and libuavcan.
Building projects using makefiles is fully supported within Eclipse.


\fig{10cm}{sw_stm32.png}{Development environment: typical session}{sw_stm32}


\subsubsection{Project structure}
The firmware folder (folders, more correctly, but here summarized as one since they follow the same system) is a self-contained unit which can be downloaded and build without the need of further operations.
This as been achieved by including all the external libraries and modules as \texttt{git} submodules, and comes with the benefit of being able to retrieve their upstream commits.

\begin{table}[H]
\centerfloat
\begin{tabular}{@{} >{\ttfamily}l l @{}}
    \toprule
    \normalfont{Directory or file}     & Description \\
    \midrule
    .                                  & Project root folder \\
    ./libuavcan/                     & UAVCAN software stack, submodule \\
    ./dsdlc\_generated/               & UAVCAN data type header files, autogenerated \\
    ./zubax\_chibios/                 & Zubax-ChibiOS middleware, submodule \\
    ./zubax\_chibios/chibios/                   & ChibiOS folder, submodule \\
    ./Makefile                       & Project-level makefile \\
    ./src/                           & Application-level code \\
    ./src/main.cpp                   & Main file, includes firmware entry point \\
    ./src/board/                     & Board module \\
    ./src/sys/                       & ChibiOS configuration files \\
    ./src/usb/                       & USB descriptors and CLI module \\
    ./src/node/                      & UAVCAN node module \\
    ./src/rtls/                       & Localization class \\
    ./src/rtls/dw1000/                & decaWave DWM1000 drivers \\
    ./src/rtls/twr/                   & Two-way ranging class \\
    ./src/build/                      & Build directory, autogenerated \\
    ./src/build/das\_uavcan\_rtls.bin     & Uploadable firmware, autogenerated \\
    \bottomrule
\end{tabular}
\caption{Software design: folder structure}\label{tab:sw_struct}
\end{table}

\autoref{tab:sw_struct} shows an overview of the project folder content.
Most files have been hidden from the table, as well as submodule subdirectories.
It is implied that each application-level module is implemented inside its respective directory.


\subsubsection{Other tools}
In order to be able to contribute from any given location (work PC, personal laptop\dots), the source code folder is hosted on a web-based \texttt{git} repository manager called \emph{GitLab}.
GitLab provides most of the functionalities of GitHub (which was originally used) but can run on premises, making it more suitable for internal research projects.
Ordinary maintenance of the repository is performed from command-line, with the aid of graphical \texttt{diff}-tool \emph{Meld} for code revision.

Whilst the IDE's powerful code completion is useful for general programming, external text editors such as \emph{SublimeText} or \emph{Atom} are sometimes used as well, especially when large amount of code has to be refactored or restructured.
